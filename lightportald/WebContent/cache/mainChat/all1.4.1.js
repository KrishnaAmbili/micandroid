var JSON=JSON||{};(function(){function f(n){return n<10?"0"+n:n}if(typeof Date.prototype.toJSON!=="function"){Date.prototype.toJSON=function(key){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(key){return this.valueOf()}}var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;function quote(string){escapable.lastIndex=0;return escapable.test(string)?'"'+string.replace(escapable,function(a){var c=meta[a];return typeof c==="string"?c:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+string+'"'}function str(key,holder){var i,k,v,length,mind=gap,partial,value=holder[key];if(value&&typeof value==="object"&&typeof value.toJSON==="function"){value=value.toJSON(key)}if(typeof rep==="function"){value=rep.call(holder,key,value)}switch(typeof value){case"string":return quote(value);case"number":return isFinite(value)?String(value):"null";case"boolean":case"null":return String(value);case"object":if(!value){return"null"}gap+=indent;partial=[];if(Object.prototype.toString.apply(value)==="[object Array]"){length=value.length;for(i=0;i<length;i+=1){partial[i]=str(i,value)||"null"}v=partial.length===0?"[]":gap?"[\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"]":"["+partial.join(",")+"]";gap=mind;return v}if(rep&&typeof rep==="object"){length=rep.length;for(i=0;i<length;i+=1){k=rep[i];if(typeof k==="string"){v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v)}}}}else{for(k in value){if(Object.hasOwnProperty.call(value,k)){v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v)}}}}v=partial.length===0?"{}":gap?"{\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"}":"{"+partial.join(",")+"}";gap=mind;return v}}if(typeof JSON.stringify!=="function"){JSON.stringify=function(value,replacer,space){var i;gap="";indent="";if(typeof space==="number"){for(i=0;i<space;i+=1){indent+=" "}}else{if(typeof space==="string"){indent=space}}rep=replacer;if(replacer&&typeof replacer!=="function"&&(typeof replacer!=="object"||typeof replacer.length!=="number")){throw new Error("JSON.stringify")}return str("",{"":value})}}if(typeof JSON.parse!=="function"){JSON.parse=function(text,reviver){var j;function walk(holder,key){var k,v,value=holder[key];if(value&&typeof value==="object"){for(k in value){if(Object.hasOwnProperty.call(value,k)){v=walk(value,k);if(v!==undefined){value[k]=v}else{delete value[k]}}}}return reviver.call(holder,key,value)}cx.lastIndex=0;if(cx.test(text)){text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})}if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){j=eval("("+text+")");return typeof reviver==="function"?walk({"":j},""):j}return null}}}());window.dhtmlHistory={isIE:false,isOpera:false,isSafari:false,isKonquerer:false,isGecko:false,isSupported:false,create:function(d){var g=this;var f=navigator.userAgent.toLowerCase();var a=navigator.platform.toLowerCase();var h=navigator.vendor||"";if(h==="KDE"){this.isKonqueror=true;this.isSupported=false}else{if(typeof window.opera!=="undefined"){this.isOpera=true;this.isSupported=true}else{if(typeof document.all!=="undefined"){this.isIE=true;this.isSupported=true}else{if(h.indexOf("Apple Computer, Inc.")>-1){this.isSafari=true;this.isSupported=(a.indexOf("mac")>-1)}else{if(f.indexOf("gecko")!=-1){this.isGecko=true;this.isSupported=true}}}}}window.historyStorage.setup(d);if(this.isSafari){this.createSafari()}else{if(this.isOpera){this.createOpera()}}var b=this.getCurrentLocation();this.currentLocation=b;if(this.isIE){this.createIE(b)}var e=function(){g.firstLoad=null};this.addEventListener(window,"unload",e);if(this.isIE){this.ignoreLocationChange=true}else{if(!historyStorage.hasKey(this.PAGELOADEDSTRING)){this.ignoreLocationChange=true;this.firstLoad=true;historyStorage.put(this.PAGELOADEDSTRING,true)}else{this.ignoreLocationChange=false;this.fireOnNewListener=true}}var c=function(){g.checkLocation()};setInterval(c,100)},initialize:function(){if(this.isIE){if(!historyStorage.hasKey(this.PAGELOADEDSTRING)){this.fireOnNewListener=false;this.firstLoad=true;historyStorage.put(this.PAGELOADEDSTRING,true)}else{this.fireOnNewListener=true;this.firstLoad=false}}},addListener:function(a){this.listener=a;if(this.fireOnNewListener){this.fireHistoryEvent(this.currentLocation);this.fireOnNewListener=false}},addEventListener:function(c,b,a){if(c.addEventListener){c.addEventListener(b,a,false)}else{if(c.attachEvent){c.attachEvent("on"+b,function(){a(window.event)})}}},add:function(c,d){if(this.isSafari){c=this.removeHash(c);historyStorage.put(c,d);this.currentLocation=c;window.location.hash=c;this.putSafariState(c)}else{var b=this;var a=function(){if(b.currentWaitTime>0){b.currentWaitTime=b.currentWaitTime-b.waitTime}c=b.removeHash(c);if(document.getElementById(c)&&b.debugMode){var f="Exception: History locations can not have the same value as _any_ IDs that might be in the document, due to a bug in IE; please ask the developer to choose a history location that does not match any HTML IDs in this document. The following ID is already taken and cannot be a location: "+c;throw new Error(f)}historyStorage.put(c,d);b.ignoreLocationChange=true;b.ieAtomicLocationChange=true;b.currentLocation=c;window.location.hash=c;if(b.isIE){b.iframe.src="blank.html?"+c}b.ieAtomicLocationChange=false};window.setTimeout(a,this.currentWaitTime);this.currentWaitTime=this.currentWaitTime+this.waitTime}},isFirstLoad:function(){return this.firstLoad},getVersion:function(){return"0.6"},getCurrentLocation:function(){var a=(this.isSafari?this.getSafariState():this.getCurrentHash());return a},getCurrentHash:function(){var b=window.location.href;var a=b.indexOf("#");return(a>=0?b.substr(a+1):"")},PAGELOADEDSTRING:"DhtmlHistory_pageLoaded",listener:null,waitTime:200,currentWaitTime:0,currentLocation:null,iframe:null,safariHistoryStartPoint:null,safariStack:null,safariLength:null,ignoreLocationChange:null,fireOnNewListener:null,firstLoad:null,ieAtomicLocationChange:null,createIE:function(a){this.waitTime=400;var b=(historyStorage.debugMode?"width: 800px;height:80px;border:1px solid black;":historyStorage.hideStyles);var d="rshHistoryFrame";var c='<iframe frameborder="0" id="'+d+'" style="'+b+'" src="blank.html?'+a+'"></iframe>';document.write(c);this.iframe=document.getElementById(d)},createOpera:function(){this.waitTime=400;var a='<img src="javascript:location.href=\'javascript:dhtmlHistory.checkLocation();\';" style="'+historyStorage.hideStyles+'" />';document.write(a)},createSafari:function(){var e="rshSafariForm";var d="rshSafariStack";var c="rshSafariLength";var b=historyStorage.debugMode?historyStorage.showStyles:historyStorage.hideStyles;var a=(historyStorage.debugMode?"width:800px;height:20px;border:1px solid black;margin:0;padding:0;":historyStorage.hideStyles);var f='<form id="'+e+'" style="'+b+'"><input type="text" style="'+a+'" id="'+d+'" value="[]"/><input type="text" style="'+a+'" id="'+c+'" value=""/></form>';document.write(f);this.safariStack=document.getElementById(d);this.safariLength=document.getElementById(c);if(!historyStorage.hasKey(this.PAGELOADEDSTRING)){this.safariHistoryStartPoint=history.length;this.safariLength.value=this.safariHistoryStartPoint}else{this.safariHistoryStartPoint=this.safariLength.value}},getSafariStack:function(){var a=this.safariStack.value;return historyStorage.fromJSON(a)},getSafariState:function(){var a=this.getSafariStack();var b=a[history.length-this.safariHistoryStartPoint-1];return b},putSafariState:function(b){var a=this.getSafariStack();a[history.length-this.safariHistoryStartPoint]=b;this.safariStack.value=historyStorage.toJSON(a)},fireHistoryEvent:function(a){var b=historyStorage.get(a);this.listener.call(null,a,b)},checkLocation:function(){if(!this.isIE&&this.ignoreLocationChange){this.ignoreLocationChange=false;return}if(!this.isIE&&this.ieAtomicLocationChange){return}var a=this.getCurrentLocation();if(a==this.currentLocation){return}this.ieAtomicLocationChange=true;if(this.isIE&&this.getIframeHash()!=a){this.iframe.src="blank.html?"+a}else{if(this.isIE){return}}this.currentLocation=a;this.ieAtomicLocationChange=false;this.fireHistoryEvent(a)},getIframeHash:function(){var b=this.iframe.contentWindow.document;var a=String(b.location.search);if(a.length==1&&a.charAt(0)=="?"){a=""}else{if(a.length>=2&&a.charAt(0)=="?"){a=a.substring(1)}}return a},removeHash:function(b){var a;if(b===null||b===undefined){a=null}else{if(b===""){a=""}else{if(b.length==1&&b.charAt(0)=="#"){a=""}else{if(b.length>1&&b.charAt(0)=="#"){a=b.substring(1)}else{a=b}}}}return a},iframeLoaded:function(a){if(this.ignoreLocationChange){this.ignoreLocationChange=false;return}var b=String(a.search);if(b.length==1&&b.charAt(0)=="?"){b=""}else{if(b.length>=2&&b.charAt(0)=="?"){b=b.substring(1)}}window.location.hash=b;this.fireHistoryEvent(b)}};window.historyStorage={setup:function(b){if(typeof b!=="undefined"){if(b.debugMode){this.debugMode=b.debugMode}if(b.toJSON){this.toJSON=b.toJSON}if(b.fromJSON){this.fromJSON=b.fromJSON}}var d="rshStorageForm";var f="rshStorageField";var a=this.debugMode?historyStorage.showStyles:historyStorage.hideStyles;var e=(historyStorage.debugMode?"width: 800px;height:80px;border:1px solid black;":historyStorage.hideStyles);var c='<form id="'+d+'" style="'+a+'"><textarea id="'+f+'" style="'+e+'"></textarea></form>';document.write(c);this.storageField=document.getElementById(f);if(typeof window.opera!=="undefined"){this.storageField.focus()}},put:function(a,b){this.assertValidKey(a);if(this.hasKey(a)){this.remove(a)}this.storageHash[a]=b;this.saveHashTable()},get:function(a){this.assertValidKey(a);this.loadHashTable();var b=this.storageHash[a];if(b===undefined){b=null}return b},remove:function(a){this.assertValidKey(a);this.loadHashTable();delete this.storageHash[a];this.saveHashTable()},reset:function(){this.storageField.value="";this.storageHash={}},hasKey:function(a){this.assertValidKey(a);this.loadHashTable();return(typeof this.storageHash[a]!=="undefined")},isValidKey:function(a){return(typeof a==="string")},showStyles:"border:0;margin:0;padding:0;",hideStyles:"left:-1000px;top:-1000px;width:1px;height:1px;border:0;position:absolute;",debugMode:false,storageHash:{},hashLoaded:false,storageField:null,assertValidKey:function(a){var b=this.isValidKey(a);if(!b&&this.debugMode){throw new Error("Please provide a valid key for window.historyStorage. Invalid key = "+a+".")}},loadHashTable:function(){if(!this.hashLoaded){var a=this.storageField.value;if(a!==""&&a!==null){this.storageHash=this.fromJSON(a);this.hashLoaded=true}}},saveHashTable:function(){this.loadHashTable();var a=this.toJSON(this.storageHash);this.storageField.value=a},toJSON:function(a){return a.toJSONString()},fromJSON:function(a){return a.parseJSON()}};if(typeof(TrimPath)=="undefined"){TrimPath={}}(function(){if(TrimPath.evalEx==null){TrimPath.evalEx=function(src){return eval(src)}}var UNDEFINED;if(Array.prototype.pop==null){Array.prototype.pop=function(){if(this.length===0){return UNDEFINED}return this[--this.length]}}if(Array.prototype.push==null){Array.prototype.push=function(){for(var i=0;i<arguments.length;++i){this[this.length]=arguments[i]}return this.length}}TrimPath.parseTemplate=function(tmplContent,optTmplName,optEtc){if(optEtc==null){optEtc=TrimPath.parseTemplate_etc}var funcSrc=parse(tmplContent,optTmplName,optEtc);var func=TrimPath.evalEx(funcSrc,optTmplName,1);if(func!=null){return new optEtc.Template(optTmplName,tmplContent,funcSrc,func,optEtc)}return null};var exceptionDetails=function(e){return(e.toString())+";\n "+(e.message)+";\n "+(e.name)+";\n "+(e.stack||"no stack trace")+";\n "+(e.description||"no further description")+";\n "+(e.fileName||"no file name")+";\n "+(e.lineNumber||"no line number")};try{String.prototype.process=function(context,optFlags){var template=TrimPath.parseTemplate(this,null);if(template!=null){return template.process(context,optFlags)}return this}}catch(e){}TrimPath.parseTemplate_etc={};TrimPath.parseTemplate_etc.statementTag="forelse|for|if|elseif|else|var|macro";TrimPath.parseTemplate_etc.statementDef={"if":{delta:1,prefix:"if (",suffix:") {",paramMin:1},"else":{delta:0,prefix:"} else {"},elseif:{delta:0,prefix:"} else if (",suffix:") {",paramDefault:"true"},"/if":{delta:-1,prefix:"}"},"for":{delta:1,paramMin:3,prefixFunc:function(stmtParts,state,tmplName,etc){if(stmtParts[2]!="in"){throw new etc.ParseError(tmplName,state.line,"bad for loop statement: "+stmtParts.join(" "))}var iterVar=stmtParts[1];var listVar="__LIST__"+iterVar;return["var ",listVar," = ",stmtParts[3],";","var __LENGTH_STACK__;","if (typeof(__LENGTH_STACK__) == 'undefined' || !__LENGTH_STACK__.length) __LENGTH_STACK__ = new Array();","__LENGTH_STACK__[__LENGTH_STACK__.length] = 0;","if ((",listVar,") != null) { ","var ",iterVar,"_ct = 0;","for (var ",iterVar,"_index in ",listVar,") { ",iterVar,"_ct++;","if (typeof(",listVar,"[",iterVar,"_index]) == 'function') {continue;}","__LENGTH_STACK__[__LENGTH_STACK__.length - 1]++;","var ",iterVar," = ",listVar,"[",iterVar,"_index];"].join("")}},forelse:{delta:0,prefix:"} } if (__LENGTH_STACK__[__LENGTH_STACK__.length - 1] == 0) { if (",suffix:") {",paramDefault:"true"},"/for":{delta:-1,prefix:"} }; delete __LENGTH_STACK__[__LENGTH_STACK__.length - 1];"},"var":{delta:0,prefix:"var ",suffix:";"},macro:{delta:1,prefixFunc:function(stmtParts,state,tmplName,etc){var macroName=stmtParts[1].split("(")[0];return["var ",macroName," = function",stmtParts.slice(1).join(" ").substring(macroName.length),"{ var _OUT_arr = []; var _OUT = { write: function(m) { if (m) _OUT_arr.push(m); } }; "].join("")}},"/macro":{delta:-1,prefix:" return _OUT_arr.join(''); };"}};TrimPath.parseTemplate_etc.modifierDef={eat:function(v){return""},escape:function(s){return String(s).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},capitalize:function(s){return String(s).toUpperCase()},"default":function(s,d){return s!=null?s:d}};TrimPath.parseTemplate_etc.modifierDef.h=TrimPath.parseTemplate_etc.modifierDef.escape;TrimPath.parseTemplate_etc.Template=function(tmplName,tmplContent,funcSrc,func,etc){this.process=function(context,flags){if(context==null){context={}}if(context._MODIFIERS==null){context._MODIFIERS={}}if(context.defined==null){context.defined=function(str){return(context[str]!=undefined)}}for(var k in etc.modifierDef){if(context._MODIFIERS[k]==null){context._MODIFIERS[k]=etc.modifierDef[k]}}if(flags==null){flags={}}var resultArr=[];var resultOut={write:function(m){resultArr.push(m)}};try{func(resultOut,context,flags)}catch(e){if(flags.throwExceptions==true){throw e}var result=new String(resultArr.join("")+"[ERROR: template: <pre>"+exceptionDetails(e)+"</pre>]");result.exception=e;return result}return resultArr.join("")};this.name=tmplName;this.source=tmplContent;this.sourceFunc=funcSrc;this.toString=function(){return"TrimPath.Template ["+tmplName+"]"}};TrimPath.parseTemplate_etc.ParseError=function(name,line,message){this.name=name;this.line=line;this.message=message};TrimPath.parseTemplate_etc.ParseError.prototype.toString=function(){return("TrimPath template ParseError in "+this.name+": line "+this.line+", "+this.message)};var parse=function(body,tmplName,etc){body=cleanWhiteSpace(body);var funcText=["var TrimPath_Template_TEMP = function(_OUT, _CONTEXT, _FLAGS) { with (_CONTEXT) {"];var state={stack:[],line:1};var endStmtPrev=-1;while(endStmtPrev+1<body.length){var begStmt=endStmtPrev;begStmt=body.indexOf("{",begStmt+1);while(begStmt>=0){var endStmt=body.indexOf("}",begStmt+1);var stmt=body.substring(begStmt,endStmt);var blockrx=stmt.match(/^\{(cdata|minify|eval)/);if(blockrx){var blockType=blockrx[1];var blockMarkerBeg=begStmt+blockType.length+1;var blockMarkerEnd=body.indexOf("}",blockMarkerBeg);if(blockMarkerEnd>=0){var blockMarker;if(blockMarkerEnd-blockMarkerBeg<=0){blockMarker="{/"+blockType+"}"}else{blockMarker=body.substring(blockMarkerBeg+1,blockMarkerEnd)}var blockEnd=body.indexOf(blockMarker,blockMarkerEnd+1);if(blockEnd>=0){emitSectionText(body.substring(endStmtPrev+1,begStmt),funcText);var blockText=body.substring(blockMarkerEnd+1,blockEnd);if(blockType=="cdata"){emitText(blockText,funcText)}else{if(blockType=="minify"){emitText(scrubWhiteSpace(blockText),funcText)}else{if(blockType=="eval"){if(blockText!=null&&blockText.length>0){funcText.push("_OUT.write( (function() { "+blockText+" })() );")}}}}begStmt=endStmtPrev=blockEnd+blockMarker.length-1}}}else{if(body.charAt(begStmt-1)!="$"&&body.charAt(begStmt-1)!="\\"){var offset=(body.charAt(begStmt+1)=="/"?2:1);if(body.substring(begStmt+offset,begStmt+10+offset).search(TrimPath.parseTemplate_etc.statementTag)==0){break}}}begStmt=body.indexOf("{",begStmt+1)}if(begStmt<0){break}var endStmt=body.indexOf("}",begStmt+1);if(endStmt<0){break}emitSectionText(body.substring(endStmtPrev+1,begStmt),funcText);emitStatement(body.substring(begStmt,endStmt+1),state,funcText,tmplName,etc);endStmtPrev=endStmt}emitSectionText(body.substring(endStmtPrev+1),funcText);if(state.stack.length!=0){throw new etc.ParseError(tmplName,state.line,"unclosed, unmatched statement(s): "+state.stack.join(","))}funcText.push("}}; TrimPath_Template_TEMP");return funcText.join("")};var emitStatement=function(stmtStr,state,funcText,tmplName,etc){var parts=stmtStr.slice(1,-1).split(" ");var stmt=etc.statementDef[parts[0]];if(stmt==null){emitSectionText(stmtStr,funcText);return}if(stmt.delta<0){if(state.stack.length<=0){throw new etc.ParseError(tmplName,state.line,"close tag does not match any previous statement: "+stmtStr)}state.stack.pop()}if(stmt.delta>0){state.stack.push(stmtStr)}if(stmt.paramMin!=null&&stmt.paramMin>=parts.length){throw new etc.ParseError(tmplName,state.line,"statement needs more parameters: "+stmtStr)}if(stmt.prefixFunc!=null){funcText.push(stmt.prefixFunc(parts,state,tmplName,etc))}else{funcText.push(stmt.prefix)}if(stmt.suffix!=null){if(parts.length<=1){if(stmt.paramDefault!=null){funcText.push(stmt.paramDefault)}}else{for(var i=1;i<parts.length;i++){if(i>1){funcText.push(" ")}funcText.push(parts[i])}}funcText.push(stmt.suffix)}};var emitSectionText=function(text,funcText){if(text.length<=0){return}var nlPrefix=0;var nlSuffix=text.length-1;while(nlPrefix<text.length&&(text.charAt(nlPrefix)=="\n")){nlPrefix++}while(nlSuffix>=0&&(text.charAt(nlSuffix)==" "||text.charAt(nlSuffix)=="\t")){nlSuffix--}if(nlSuffix<nlPrefix){nlSuffix=nlPrefix}if(nlPrefix>0){funcText.push('if (_FLAGS.keepWhitespace == true) _OUT.write("');var s=text.substring(0,nlPrefix).replace("\n","\\n");if(s.charAt(s.length-1)=="\n"){s=s.substring(0,s.length-1)}funcText.push(s);funcText.push('");')}var lines=text.substring(nlPrefix,nlSuffix+1).split("\n");for(var i=0;i<lines.length;i++){emitSectionTextLine(lines[i],funcText);if(i<lines.length-1){funcText.push('_OUT.write("\\n");\n')}}if(nlSuffix+1<text.length){funcText.push('if (_FLAGS.keepWhitespace == true) _OUT.write("');var s=text.substring(nlSuffix+1).replace("\n","\\n");if(s.charAt(s.length-1)=="\n"){s=s.substring(0,s.length-1)}funcText.push(s);funcText.push('");')}};var emitSectionTextLine=function(line,funcText){var endMarkPrev="}";var endExprPrev=-1;while(endExprPrev+endMarkPrev.length<line.length){var begMark="${",endMark="}";var begExpr=line.indexOf(begMark,endExprPrev+endMarkPrev.length);if(begExpr<0){break}if(line.charAt(begExpr+2)=="%"){begMark="${%";endMark="%}"}var endExpr=line.indexOf(endMark,begExpr+begMark.length);if(endExpr<0){break}emitText(line.substring(endExprPrev+endMarkPrev.length,begExpr),funcText);var exprArr=line.substring(begExpr+begMark.length,endExpr).replace(/\|\|/g,"#@@#").split("|");for(var k in exprArr){if(exprArr[k].replace){exprArr[k]=exprArr[k].replace(/#@@#/g,"||")}}funcText.push("_OUT.write(");emitExpression(exprArr,exprArr.length-1,funcText);funcText.push(");");endExprPrev=endExpr;endMarkPrev=endMark}emitText(line.substring(endExprPrev+endMarkPrev.length),funcText)};var emitText=function(text,funcText){if(text==null||text.length<=0){return}text=text.replace(/\\/g,"\\\\");text=text.replace(/\n/g,"\\n");text=text.replace(/"/g,'\\"');funcText.push('_OUT.write("');funcText.push(text);funcText.push('");')};var emitExpression=function(exprArr,index,funcText){var expr=exprArr[index];if(index<=0){funcText.push(expr);return}var parts=expr.split(":");funcText.push('_MODIFIERS["');funcText.push(parts[0]);funcText.push('"](');emitExpression(exprArr,index-1,funcText);if(parts.length>1){funcText.push(",");funcText.push(parts[1])}funcText.push(")")};var cleanWhiteSpace=function(result){result=result.replace(/\t/g,"    ");result=result.replace(/\r\n/g,"\n");result=result.replace(/\r/g,"\n");result=result.replace(/^(\s*\S*(\s+\S+)*)\s*$/,"$1");return result};var scrubWhiteSpace=function(result){result=result.replace(/^\s+/g,"");result=result.replace(/\s+$/g,"");result=result.replace(/\s+/g," ");result=result.replace(/^(\s*\S*(\s+\S+)*)\s*$/,"$1");return result};TrimPath.parseDOMTemplate=function(elementId,optDocument,optEtc){if(optDocument==null){optDocument=document}var element=optDocument.getElementById(elementId);var content=element.value;if(content==null){content=element.innerHTML}content=content.replace(/&lt;/g,"<").replace(/&gt;/g,">");return TrimPath.parseTemplate(content,elementId,optEtc)};TrimPath.processDOMTemplate=function(elementId,context,optFlags,optDocument,optEtc){return TrimPath.parseDOMTemplate(elementId,optDocument,optEtc).process(context,optFlags)}})();var Light={Version:"1.4.0",_THEME_ROOT:"/light/theme/",_PR_PREFIX:"prid_",_PT_PREFIX:"ptid_",_VIEW_MODE:"view",_EDIT_MODE:"edit",_HELP_MODE:"help",_CONFIG_MODE:"config",_NORMAL_STATE:"normal",_MINIMIZED_STATE:"minimized",_MAXIMIZED_STATE:"maximized",maxZIndex:1};L$=function(b){if(arguments.length>1){for(var a=0,d=[],c=arguments.length;a<c;a++){d.push(L$(arguments[a]))}return d}return document.getElementById(b)};L$$=(typeof(document.querySelectorAll)!="undefined")?function(e){if(arguments.length>1){for(var d=0,g=[],f=arguments.length;d<f;d++){var c=L$$(arguments[d]);if(c){for(var b=0,a=c.length;b<a;b++){g.push(c[b])}}}return g}return document.querySelectorAll(e)}:function(){return[]};window.onload=function(){Light.startup()};Light.startup=function(){Light.init();Light.start()};Light.init=function(){var b=L$("REQUEST_SUFFIX");var a=Light._REQUEST_SUFFIX=(b)?b.title:".lp";Light._CLOSE_CHAT="/closeChat"+a;Light._SHOW_INVITE_LIST="/showInviteList"+a;Light._INVITE_BUDDYS_TO_CHAT="/inviteBuddysToChat"+a;b=L$("CONTEXT_PATH");Light._CONTEXT_PATH=(b)?b.title:""};Light.start=function(){Light.portal=new LightPortal();Light.portal.start();enterChattingRoom(window.opener.document.getElementById("chattingRoomId").title,window.opener.document.getElementById("chattingRoomName").title);Light.portal.resize()};window.onresize=function(){Light.portal.resize()};window.onbeforeunload=function(){if(Light.portal.confirmClose){var a=Light.confirm(Light.getMessage("COMMAND_CLOSE_POPUP_PORTLET"));if(!a){return false}}for(var b=0;b<Light.portal.portlets.length;b++){if(Light.portal.portlets[b]!=null){Light.portal.portlets[b].close(true)}}};function LightPortal(){var b=document.documentElement.scrollWidth;var a=0;var c=document.documentElement.scrollHeight;this.layout={containerLeft:0,containerTop:0,containerWidth:b,bodyLeft:a/2,bodyTop:80,maxLeft:0,maxTop:40,maxWidth:b-a,maxHeight:c,minHeight:40,scrollbarWidth:21,footerMarginTop:100,barWidth:a};this.portlets=[];this.confirmClose=true}LightPortal.prototype.start=function(){this.container=this.createPortalContainer();document.body.appendChild(this.container)};LightPortal.prototype.createPortalContainer=function(){var a=Light.newElement({element:"div",id:"portalContainer",className:"portal-container",style:{position:"absolute",zIndex:++Light.maxZIndex,fontSize:12,width:this.layout.containerWidth,height:this.layout.maxHeight}});a.style.backgroundColor="#ffffff";document.body.style.background="#ffffff";setPosition(a,this.layout.containerLeft,this.layout.containerTop);return a};Light.getUserId=function(){return(Light.userId)?Light.userId:Light.getCookie(Light._LOGINED_USER_ID)};Light.executePortlet=function(c){var b=Light.getPortletById(c);var a="responseId="+c+"&tabId=0&portletId="+b.serverId+"&mode="+b.mode+"&isRenderUrl=true&disablePageRefresh=1";if(b.parameter.length>0){a=a+"&"+b.parameter}if(b.maximized){a=a+"&state=maximized"}if(b.refreshAction){b.refreshAction=false;a=a+"&refresh=true"}if(b.state==Light._MINIMIZED_STATE&&!b.minimized){b.minimize()}else{if(b.state==Light._MAXIMIZED_STATE&&!b.maximized){b.maximize()}else{Light.ajax.sendRequestAndUpdate(b.requestUrl,c,{evalScripts:b.allowJS,parameters:a})}}};Light.getPortletById=function(c){var a=c.split("_");for(var b=0;b<Light.portal.portlets.length;b++){if(Light.portal.portlets[b]!=null&&Light.portal.portlets[b].serverId==a[1]){return Light.portal.portlets[b]}}};Light.getContextPath=function(){var a=L$("CONTEXT_PATH");return(a)?a.title:Light._CONTEXT_PATH};Light.getViewTemplate=function(a,c){var b="";if(document.getElementById(a)!=null){b=TrimPath.processDOMTemplate(a,c)}return b};Light.getThemePath=function(a){if(a==null){a=L$("theme").title}return Light.getContextPath()+Light._THEME_ROOT+a};Light.setPortletContent=function(responseId,inHTML){var portlet=Light.getPortletById(responseId);if(!portlet.minimized){if(portlet.allowJS){var scriptFragment="(?:<script.*?>)((\n|\r|.)*?)(?:<\/script>)";var matchAll=new RegExp(scriptFragment,"img");var scripts=inHTML.match(matchAll);if(scripts!=null){portlet.setContent(inHTML.replace(matchAll,""));for(var i=0;i<scripts.length;i++){var script=scripts[i];var scriptBegin="(?:<script.*?>)";script=script.replace(new RegExp(scriptBegin,"img"),"");var scriptEnd="(?:<\/script>)";script=script.replace(new RegExp(scriptEnd,"img"),"");try{eval(script)}catch(e){}}}else{var scriptFragment2="(?:<script.*?>)";matchAll=new RegExp(scriptFragment2,"im");var scripts=inHTML.match(matchAll);if(scripts!=null){portlet.setContent(inHTML.replace(matchAll,""));for(var i=0;i<scripts.length;i++){var script=scripts[i];var s=document.createElement("script");s.type="text/javascript";var indx=script.indexOf("src=");script=script.substr(indx+5);indx=script.indexOf(".js");script=script.substring(0,indx+3);s.src=script;document.getElementsByTagName("head")[0].appendChild(s)}}else{portlet.setContent(inHTML)}}}else{portlet.setContent(inHTML)}Light.refreshTextFontSize()}};Light.refreshTextFontSize=function(){var a=12;document.body.style.fontSize=a+"px";var c=L$("a","label","li","td","text","textarea","select");for(var b=0;b<c.length;b++){c[b].style.fontSize=a+"px"}c=null};LightPortal.prototype.resize=function(){var d=document.documentElement.scrollWidth;if(document.all){d=d-Light.portal.layout.scrollbarWidth}var c=0;var b=d-c;Light.portal.layout.maxWidth=b;Light.portal.layout.maxHeight=document.documentElement.scrollHeight;Light.portal.layout.containerWidth=d;Light.portal.layout.barWidth=c;Light.portal.layout.bodyLeft=c/2;Light.portal.container.style.width=Light.portal.layout.containerWidth;Light.portal.container.style.height=Light.portal.layout.maxHeight;for(var a=0;a<this.portlets.length;a++){if(this.portlets[a]!=null){this.portlets[a].width=Light.portal.layout.maxWidth;this.portlets[a].left=0;this.portlets[a].height=Light.portal.layout.maxHeight;this.portlets[a].refreshPosition()}}};function PortletChatWindow(y,d,r,A,w,f,b,s,o,t,c,m,i,g,q,j,h,z,k,x,e,v,a,u){Light.portal.portlets.push(this);this.window=new WindowSkin21();this.parent=null;this.popup=true;this.allowMove=true;this.mode=Light._VIEW_MODE;this.state=Light._NORMAL_STATE;this.tIndex=0;this.serverId=Date.parse(new Date());this.id=Light._PR_PREFIX+this.serverId;this.position=y;this.left=d;this.top=d;this.width=r;this.title=A;this.icon=w;this.url=f;this.name=b;this.requestUrl=s;this.closeable=o;this.refreshMode=t;this.editMode=c;this.helpMode=m;this.configMode=i;this.allowMinimized=true;if(v!=null&&!v){this.allowMinimized=false}this.allowMaximized=true;if(a!=null&&!a){this.allowMaximized=false}this.allowPopout=true;if(u!=null&&!u){this.allowPopout=false}this.autoRefreshed=g;this.refreshAtClient=q;this.periodTime=j;this.allowJS=h;this.barBgColor=z;this.barFontColor=k;this.className="portlet-popup";this.contentBgColor="#EEF6FF";if(x!=""){this.contentBgColor=x}this.parameter=e;this.index=0;var n=0;var l=0;var p=0;this.originalTop=this.top;this.originalWidth=this.width;this.originalLeft=this.left;this.minimized=false;this.maximized=true;this.isPopout=true;this.window.render(this);this.moveable=false;this.autoRefreshWhenMaximized=true;this.autoShow=false;this.opacity=0;this.fade="in";this.myPictureIndex=0;this.myPictures=[];this.autoShowId=null;this.mouseDownX=0;this.mouseDownY=0;this.refreshPosition();this.focus();if(this.autoRefreshed){this.firstTimeAutoRefreshed=true;this.autoRefresh(this)}}PortletChatWindow.prototype.rememberMode=function(a){};PortletChatWindow.prototype.focus=function(){this.window.focus(this)};PortletChatWindow.prototype.show=function(){this.window.show(this)};PortletChatWindow.prototype.hide=function(){this.window.hide(this)};PortletChatWindow.prototype.moveBegin=function(a){};PortletChatWindow.prototype.moveEnd=function(){};PortletChatWindow.prototype.move=function(a){};PortletChatWindow.prototype.startMoveTimer=function(a){};PortletChatWindow.prototype.refreshPosition=function(){this.window.position(this);this.focus()};PortletChatWindow.prototype.autoRefresh=function(a){if(a.autoRefreshed){if(a.firstTimeAutoRefreshed){a.firstTimeAutoRefreshed=false}else{a.selfRefresh()}a.timer=setTimeout((function(){a.autoRefresh(a)}),a.periodTime)}};PortletChatWindow.prototype.selfRefresh=function(){if(!this.minimized&&(!this.maximized||this.autoRefreshWhenMaximized)){if(this.mode==Light._VIEW_MODE){this.refresh()}}};PortletChatWindow.prototype.refresh=function(a){var b=this.id;this.refreshAction=true;Light.executePortlet(b)};PortletChatWindow.prototype.changePosition=function(){};PortletChatWindow.prototype.edit=function(){if(this.editMode){this.mode=Light._EDIT_MODE;var a=this.id;Light.executePortlet(a);this.window.refreshButtons(this)}};PortletChatWindow.prototype.cancelEdit=function(){if(this.editMode){this.mode=Light._VIEW_MODE;var a=this.id;Light.executePortlet(a);this.window.refreshButtons(this)}};PortletChatWindow.prototype.help=function(){if(this.helpMode){this.mode=Light._HELP_MODE;var a=this.id;Light.executePortlet(a);this.window.refreshButtons(this)}};PortletChatWindow.prototype.cancelHelp=function(){if(this.helpMode){this.mode=Light._VIEW_MODE;var a=this.id;Light.executePortlet(a);this.window.refreshButtons(this)}};PortletChatWindow.prototype.config=function(){if(this.configMode){this.mode=Light._CONFIG_MODE;this.window.refreshButtons(this);var a={id:this.id,title:this.title,barBgColor:this.barBgColor,barFontColor:this.barFontColor,contentBgColor:this.contentBgColor,textColor:this.textColor,transparent:this.transparent};Light.setPortletContent(a.id,Light.getViewTemplate("configMode.jst",a));this.refreshButtons()}};PortletChatWindow.prototype.cancelConfig=function(){if(this.configMode){this.mode=Light._VIEW_MODE;var a=this.id;Light.executePortlet(a);this.window.refreshButtons(this)}};PortletChatWindow.prototype.moveCancel=function(){};PortletChatWindow.prototype.moveAllowed=function(){};PortletChatWindow.prototype.moveUp=function(){};PortletChatWindow.prototype.moveDown=function(){};PortletChatWindow.prototype.moveLeft=function(){};PortletChatWindow.prototype.moveRight=function(){};PortletChatWindow.prototype.minimize=function(){};PortletChatWindow.prototype.maximize=function(a){this.windowMaximize(a);this.refresh()};PortletChatWindow.prototype.windowMaximize=function(a){this.maximized=!this.maximized;if(!this.maximized){this.state=Light._NORMAL_STATE;this.top=this.originalTop;this.width=this.originalWidth;this.left=this.originalLeft}else{this.state=Light._MAXIMIZED_STATE;this.left=Light.portal.layout.maxLeft;this.top=Light.portal.layout.maxTop;this.width=Light.portal.layout.maxWidth}this.window.maximize(this)};PortletChatWindow.prototype.popout=function(){this.isPopout=!this.isPopout;if(!this.isPopout){Light.portal.confirmClose=false;window.opener.popinChatRoom(this.parameter,this.title);window.close()}else{}};PortletChatWindow.prototype.close=function(b){if(b==null||!b){var a=Light.confirm(Light.getMessage("COMMAND_CLOSE_POPUP_CHAT"));if(!a){return}}if(this.maximized){this.windowMaximize()}if(this.isPopout){Light.ajax.sendRequest(Light._CLOSE_CHAT,{parameters:this.parameter})}for(var c=0;c<Light.portal.portlets.length;c++){if(Light.portal.portlets[c].serverId==this.serverId){Light.portal.portlets[c]=null}}if(this.timer){clearTimeout(this.timer)}this.window.close(this);window.close()};PortletChatWindow.prototype.refreshButtons=function(){this.window.refreshButtons(this)};PortletChatWindow.prototype.refreshWindow=function(){this.window.refreshWindow(this)};PortletChatWindow.prototype.refreshHeader=function(){this.window.refreshHeader(this)};PortletChatWindow.prototype.refreshWindowTransparent=function(){};PortletChatWindow.prototype.refreshTextColor=function(){};PortletChatWindow.prototype.getTop=function(){return this.window.top};PortletChatWindow.prototype.getHeight=function(){return this.window.container.clientHeight};PortletChatWindow.prototype.setContent=function(b){var a=this.window.container.container;a.innerHTML=b;setTimeout((function(){if(a.scrollHeight>0){a.scrollTop=a.scrollHeight}else{a.scrollTop=a.offsetHeight}a=null}),100)};function WindowSkin(){this.left=0;this.top=0}WindowSkin.prototype.render=function(a){};WindowSkin.prototype.focus=function(a){};WindowSkin.prototype.show=function(a){};WindowSkin.prototype.hide=function(a){};WindowSkin.prototype.position=function(a){};WindowSkin.prototype.minimize=function(a){};WindowSkin.prototype.maximize=function(a){};WindowSkin.prototype.close=function(a){};WindowSkin.prototype.refreshWindow=function(a){};WindowSkin.prototype.refreshHeader=function(a){};WindowSkin.prototype.refreshButtons=function(a){};WindowSkin.prototype.setContent=function(a){this.container.innerHTML=a};WindowSkin21.prototype=new WindowSkin;WindowSkin21.prototype.constructor=WindowSkin21;function WindowSkin21(){this.type="WindowSkin2"}WindowSkin21.prototype.render=function(a){this.window=this.createPortletWindow(a);this.container=this.createPortletContainer(a);this.header=this.createPortletHeader(a,this);this.headerButton=this.createPortletHeaderButton(a);if(this.headerButton!=null){this.header.appendChild(this.headerButton)}this.window.appendChild(this.header);this.window.appendChild(this.container);Light.portal.container.appendChild(this.window)};WindowSkin21.prototype.focus=function(b){var a=++Light.maxZIndex;this.window.style.zIndex=a};WindowSkin21.prototype.show=function(a){this.window.style.visibility="visible"};WindowSkin21.prototype.hide=function(a){this.window.style.visibility="hidden"};WindowSkin21.prototype.position=function(a){this.window.style.width=a.width;this.header.style.width=a.width;this.container.style.width=a.width;if(document.all){this.window.style.posLeft=a.left;this.window.style.posTop=a.top}else{this.window.style.left=a.left;this.window.style.top=a.top}this.focus(a)};WindowSkin21.prototype.minimize=function(a){this.window.removeChild(this.header);this.header=this.createPortletHeader(a,this);this.headerButton=this.createPortletHeaderButton(a);this.header.appendChild(this.headerButton);this.window.insertBefore(this.header,this.container);this.position(a)};WindowSkin21.prototype.maximize=function(a){this.window.removeChild(this.header);this.header=this.createPortletHeader(a,this);this.headerButton=this.createPortletHeaderButton(a);this.header.appendChild(this.headerButton);this.window.insertBefore(this.header,this.container);this.position(a)};WindowSkin21.prototype.close=function(a){this.window.removeChild(this.header);this.window.removeChild(this.container);Light.portal.container.removeChild(this.window)};WindowSkin21.prototype.refreshWindow=function(a){this.window.removeChild(this.header);this.window.removeChild(this.container);this.header=this.createPortletHeader(a,this);this.headerButton=this.createPortletHeaderButton(a);this.container=this.createPortletContainer(a);this.header.appendChild(this.headerButton);this.window.appendChild(this.header);this.window.appendChild(this.container);this.position(a)};WindowSkin21.prototype.refreshHeader=function(a){this.window.removeChild(this.header);this.header=this.createPortletHeader(a,this);this.headerButton=this.createPortletHeaderButton(a);this.header.appendChild(this.headerButton);this.window.insertBefore(this.header,this.container)};WindowSkin21.prototype.refreshButtons=function(a){this.window.removeChild(this.header);this.header=this.createPortletHeader(a,this);this.headerButton=this.createPortletHeaderButton(a);this.header.appendChild(this.headerButton);this.window.insertBefore(this.header,this.container);this.position(a)};WindowSkin21.prototype.createPortletWindow=function(b){var a=document.createElement("div");a.id="portlet_"+b.serverId;a.style.position="absolute";a.className="portlet2";a.style.zIndex=++Light.maxZIndex;if(b&&b.contentBgColor&&b.contentBgColor.length>0){a.style.backgroundColor=b.contentBgColor}else{if(Light.portal.data.portletWindowTransparent==false&&b.transparent==false){a.style.backgroundColor="#ffffff"}}return a};WindowSkin21.prototype.createPortletHeader=function(g,d){var a=document.createElement("div");if(!g.minimized){a.className="portlet2-header";if(g.barBgColor){a.style.backgroundImage="none";a.style.backgroundColor=g.barBgColor}}else{a.className="portlet2-header-min"}a.onmousedown=function(h){g.focus()};var f=document.createElement("span");var b="";if(g.icon.length>0){if(g.icon.indexOf("/")>=0){if(g.icon.substring(0,4)=="http"){b="<img src='"+g.icon+"' height='16' width='16' />"}else{b="<img src='"+Light.getContextPath()+g.icon+"' height='16' width='16'/>"}}else{var c=g.icon.split(" ");var e="";if(c.length>1){e=c[0]}b="<span class='"+e+"'><span class='"+g.icon+"'></span></span>"}}if(g.url){b=b+"<a href='"+g.url+"' target='_blank' style='margin-left:5px;'>";if(g.barFontColor.length>0){b=b+"<font color='"+g.barFontColor+"'>"}b=b+g.title;if(g.barFontColor.length>0){b=b+"</font>"}b=b+"</a>"}else{b=b+"<label style='margin-left:5px;'>"+g.title+"</label>"}f.innerHTML=b;f.className="portlet2-header-title";if(g.barFontColor.length>0){f.style.color=g.barFontColor}a.appendChild(f);return a};WindowSkin21.prototype.createPortletContainer=function(e){var d=document.createElement("div");d.id=e.id+"_container";d.onmousedown=function(){e.focus()};if(e&&e.contentBgColor&&e.contentBgColor.length>0){d.style.backgroundColor=e.contentBgColor}var b=document.createElement("div");b.className="chattingBox";b.id=e.id;d.container=b;d.appendChild(b);if(!e.minimized){var a=document.createElement("div");var c={id:e.id};a.innerHTML=Light.getViewTemplate("chattingInput.jst",c);d.appendChild(a)}return d};WindowSkin21.prototype.createPortletHeaderButton=function(o){var d="<div title='"+Light.getMessage("REFRESH_PORTLET")+"' class='icons refresh_on' style='this.style.MozOpacity=1;this.filters.alpha.opacity=100'></div>";var k="<div title='"+Light.getMessage("EDIT_MODE")+"' class='icons edit_on' style='this.style.MozOpacity=1;this.filters.alpha.opacity=100'></div>";var i="<div title='"+Light.getMessage("HELP_MODE")+"' class='icons leave_edit_on' style='this.style.MozOpacity=1;this.filters.alpha.opacity=100'></div>";var n="<div title='"+Light.getMessage("HELP_MODE")+"' class='icons help_on' style='this.style.MozOpacity=1;this.filters.alpha.opacity=100'></div>";var l="<div title='"+Light.getMessage("VIEW_MODE")+"'  class='icons leave_help_on' style='this.style.MozOpacity=1;this.filters.alpha.opacity=100'></div>";var e="<div title='"+Light.getMessage("CONFIG_MODE")+"' class='icons config_on' style='this.style.MozOpacity=1;this.filters.alpha.opacity=100'></div>";var v="<div title='"+Light.getMessage("VIEW_MODE")+"' class='icons leave_config_on' style='this.style.MozOpacity=1;this.filters.alpha.opacity=100'></div>";var q="<div title='"+Light.getMessage("MINIMIZED")+"' class='icons min_on' style='this.style.MozOpacity=1;this.filters.alpha.opacity=100'></div>";var t="<div title='"+Light.getMessage("RESTORE")+"' class='icons restore_on' style='this.style.MozOpacity=1;this.filters.alpha.opacity=100'></div>";var s="<div title='"+Light.getMessage("MAXIMIZED")+"' class='icons max_on' style='this.style.MozOpacity=1;this.filters.alpha.opacity=100'></div>";var j="<div title='"+Light.getMessage("POPIN")+"' class='icons pop_in' style='this.style.MozOpacity=1;this.filters.alpha.opacity=100'></div>";var a="<div title='"+Light.getMessage("CLOSE")+"' class='icons close_on' style='this.style.MozOpacity=1;this.filters.alpha.opacity=100'></div>";var h=document.createElement("div");h.className="portlet2-header-button";if(o.closeable){var c=document.createElement("span");c.className="icons";c.innerHTML=a;c.onclick=function(){o.close();o.moveAllowed()};c.onmousedown=function(){o.moveCancel()};h.appendChild(c)}if(o.allowPopout){var r=document.createElement("span");r.className="icons";if(o.isPopout){r.innerHTML=j}r.onclick=function(){o.popout();o.moveAllowed()};r.onmousedown=function(){o.moveCancel()};h.appendChild(r)}if(o.allowMaximized){var f=document.createElement("span");f.className="icons";if(o.maximized){f.innerHTML=t}else{f.innerHTML=s}f.onclick=function(){o.maximize();o.moveAllowed()};f.onmousedown=function(){o.moveCancel()};h.appendChild(f)}if(o.allowMinimized){var g=document.createElement("span");g.className="icons";if(o.minimized){g.innerHTML=t}else{g.innerHTML=q}g.onclick=function(){o.minimize();o.moveAllowed()};g.onmousedown=function(){o.moveCancel()};h.appendChild(g)}if(o.configMode){var u=document.createElement("span");u.className="icons";if(o.mode==Light._CONFIG_MODE){u.innerHTML=v;u.onclick=function(){o.cancelConfig();o.moveAllowed()}}else{u.innerHTML=e;u.onclick=function(){o.config();o.moveAllowed()}}u.onmousedown=function(){o.moveCancel()};h.appendChild(u)}if(o.helpMode){var p=document.createElement("span");p.className="icons";if(o.mode==Light._HELP_MODE){p.innerHTML=l;p.onclick=function(){o.cancelHelp();o.moveAllowed()}}else{p.innerHTML=n;p.onclick=function(){o.help();o.moveAllowed()}}p.onmousedown=function(){o.moveCancel()};h.appendChild(p)}if(o.editMode){var m=document.createElement("span");m.className="icons";if(o.mode==Light._EDIT_MODE){m.innerHTML=i;m.onclick=function(){o.cancelEdit();o.moveAllowed()}}else{m.innerHTML=k;m.onclick=function(){o.edit();o.moveAllowed()}}m.onmousedown=function(){o.moveCancel()};h.appendChild(m)}if(o.refreshMode){var b=document.createElement("span");b.className="icons";b.innerHTML=d;b.onclick=function(){o.refresh();o.moveAllowed()};b.onmousedown=function(){o.moveCancel()};h.appendChild(b)}return h};enterChattingRoom=function(c,b){var a=new PortletChatWindow(12,0,300,b,"icons chat","","chattingPortlet",Light.getContextPath()+"/chattingPortlet"+Light._REQUEST_SUFFIX,true,false,false,false,false,true,false,5000,true,"","","",c,false,false);a.refresh();document.forms["form_"+a.id]["chat"].focus()};keyDownChat=function(b,c){var a;if(window.event){keyID=window.event.keyCode}else{keyID=b.which}if(keyID==13){sendChatMessage(c)}return !(keyID==13)};sendChatMessage=function(d){var a=document.forms["form_"+d]["chat"].value;var c=Light.getPortletById(d);var b="responseId="+d+"&tabId=0&portletId="+c.serverId+"&action=send&"+c.parameter+"&chat="+encodeURIComponent(a);Light.ajax.sendRequestAndUpdate(c.requestUrl,d,{evalScripts:false,parameters:b});document.forms["form_"+d]["chat"].value="";document.forms["form_"+d]["chat"].focus()};showInviteList=function(c){var b=Light.getPortletById(c);var a=b.parameter;Light.ajax.sendRequest(Light._SHOW_INVITE_LIST,{parameters:a,onSuccess:showInviteListHandler})};showInviteListHandler=function(a){var b=a.responseText;var c={title:Light.getMessage("CLOSE"),ok:Light.getMessage("BUTTON_OK"),content:b,popupName:"inviteList"};createTopPopupDiv("inviteList","inviteList.jst",300,c,null)};inviteBuddysToChat=function(b){var e=b.chattingId.value;var d="";for(var a=0;a<b.elements.length;a++){if(b.elements[a].type=="checkbox"&&b.elements[a].checked&&!b.elements[a].disabled){d+=b.elements[a].value+","}}var c="chattingId="+e+"&userIds="+d;Light.ajax.sendRequest(Light._INVITE_BUDDYS_TO_CHAT,{parameters:c})};createTopPopupDiv=function(a,m,d,g,h,c,i){var f=document.getElementById(a);if(f!=null&&i!=null&&i){hideTopPopupDiv(a)}else{if(f!=null){return}}var b=document.createElement("div");b.id=a;b.style.position="absolute";b.className="portlet-popup";if(d!=null){b.style.width=d}b.innerHTML=TrimPath.processDOMTemplate(m,g);var l=getMousePositionX(h)+10;var k=getMousePositionY(h);if(k<=0&&c!=null){portlet=Light.getPortletById(c);if(portlet!=null){l=portlet.left+100;k=portlet.top}}if(parseInt(l)+parseInt(d)>document.body.clientWidth){l=parseInt(l)-parseInt(d)}setPosition(b,l,k);var j=++Light.maxZIndex+1000;b.style.zIndex=j;document.body.appendChild(b);b=null};function hideTopPopupDiv(b){var a=document.getElementById(b);if(a!=null){document.body.removeChild(a);document.body.onclick=null;return true}return false}if(window.DOMParser&&window.XMLSerializer&&window.Node&&Node.prototype&&Node.prototype.__defineGetter__){if(!Document.prototype.loadXML){Document.prototype.loadXML=function(b){var c=(new DOMParser()).parseFromString(b,"text/xml");while(this.hasChildNodes()){this.removeChild(this.lastChild)}for(var a=0;a<c.childNodes.length;a++){this.appendChild(this.importNode(c.childNodes[a],true))}}}Document.prototype.__defineGetter__("xml",function(){return(new XMLSerializer()).serializeToString(this)})}Light.ajax={sendRequestAndUpdate:function(f,a,c){var d=this.getXmlHttpObject();if(!c.method){c.method="post"}if(c.asynchronous==null){c.asynchronous=true}var b=(f.lastIndexOf("/")<=0)?Light.getContextPath()+f:f;if(c.method=="get"){if(b.indexOf("?")>0){b+="&_requestOwnerId="+Light.getUserId()+"&clientUrl="+document.location.href}else{b+="?_requestOwnerId="+Light.getUserId()+"&clientUrl="+document.location.href}}d.open(c.method,b,c.asynchronous);if(c.asynchronous){d.onreadystatechange=function(){if(d.readyState==4){Light.ajax.onRequestComplete(d)}}}if(c.method=="post"){d.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8")}else{d.setRequestHeader("Content-Type","text/xml")}var e=c.parameters;if(c.postBody){e=c.postBody}if(e){e+="&_requestOwnerId="+Light.getUserId()+"&clientUrl="+document.location.href}else{e="_requestOwnerId="+Light.getUserId()+"&clientUrl="+document.location.href}d.send(c.method=="post"?e:null);log("url: "+b+" method: "+c.method+((c.method=="post")?" parameter: "+e:"")+" asyn: "+c.asynchronous);setTimeout((function(){Light.ajax.timeout(d,a)}),Light._REQUEST_TIMEOUT);if(!c.asynchronous){Light.ajax.onRequestComplete(d)}},timeout:function(b,a){if(b){if(b.status<200||b.status>=300){b.abort();Light.setPortletContent(a,"Content is not available.");b=null}}else{Light.setPortletContent(a,"Content is not available.")}},sendRequest:function(f,b){var d=this.getXmlHttpObject();if(!b.method){b.method="post"}if(b.asynchronous==null){b.asynchronous=true}var c=Light.getContextPath();var a=(f.lastIndexOf("/")<=0)?((c)?c+f:f):f;if(b.method=="get"){if(a.indexOf("?")>0){a+="&_requestOwnerId="+Light.getUserId()+"&clientUrl="+document.location.href}else{a+="?_requestOwnerId="+Light.getUserId()+"&clientUrl="+document.location.href}}d.open(b.method,a,b.asynchronous);if(b.asynchronous){d.onreadystatechange=function(){if(d.readyState==4&&d.status==200){if(b.onSuccess!=null){b.onSuccess(d)}d=null}}}if(b.method=="post"){d.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8")}else{d.setRequestHeader("Content-Type","text/xml")}var e=b.parameters;if(b.postBody){e=b.postBody}if(e){e+="&_requestOwnerId="+Light.getUserId()+"&clientUrl="+document.location.href}else{e="_requestOwnerId="+Light.getUserId()+"&clientUrl="+document.location.href}d.send(b.method=="post"?e:null);log("url: "+a+" method: "+b.method+((b.method=="post")?" parameter: "+e:"")+" asyn: "+b.asynchronous);if(!b.asynchronous){return d.responseText}},onRequestComplete:function(f){if(!f){return}if(f.status!=200){return}if(f.responseText){var e=f.responseText;var c=e.indexOf("id='");while(c>0){var h=e.substr(c+4);c=h.indexOf("'");var a=h.substring(0,c);c=h.indexOf("'>");h=h.substr(c+2);c=h.indexOf("</response>");var d=h.substring(0,c);if(a.startsWith(Light._PT_PREFIX)){if(d&&d.trim().length>0){var g=JSON.parse(d);Light.setPortletTitle(a,g)}}else{Light.setPortletContent(a,d)}e=h.substr(c);c=e.indexOf("id='")}}else{if(f.responseXML){var b=f.responseXML.getElementsByTagName("ajax-response");if(b){Light.ajax.processAjaxResponse(b[0].childNodes)}}}f=null},processAjaxResponse:function(c){for(var b=0;b<c.length;b++){var f=c[b];if(f.nodeType!=1){continue}var a=f.getAttribute("id");var d=Light.ajax.getContentAsString(f);if(a.startsWith(Light._PT_PREFIX)){if(d&&d.trim().length>0){var e=JSON.parse(d);Light.setPortletTitle(a,e)}}else{Light.setPortletContent(a,d)}}},getContentAsString:function(a){return a.xml!=undefined?Light.ajax.getContentAsStringIE(a):Light.ajax.getContentAsStringMozilla(a)},getContentAsStringIE:function(a){var c="";for(var b=0;b<a.childNodes.length;b++){var d=a.childNodes[b];if(d.nodeType==4){c+=d.nodeValue}else{c+=d.xml}}return c},getContentAsStringMozilla:function(b){var a=new XMLSerializer();var d="";for(var c=0;c<b.childNodes.length;c++){var e=b.childNodes[c];if(e.nodeType==4){d+=e.nodeValue}else{d+=a.serializeToString(e)}}return d},getXmlHttpObject:function(){var a;try{a=new ActiveXObject("Msxml2.XMLHTTP")}catch(c){try{a=new ActiveXObject("Microsoft.XMLHTTP")}catch(b){a=false}}if(!a&&typeof XMLHttpRequest!="undefined"){try{a=new XMLHttpRequest()}catch(c){a=false}}return a}};function log(a){}function logDebug(a){if(!log.window_||log.window_.closed){var c=window.open("",null,"width=400,height=200,scrollbars=yes,resizable=yes,status=no,location=no,menubar=no,toolbar=no");if(!c){return}var b=c.document;b.write("<html><head><title>Debug Log</title></head><body></body></html>");b.close();log.window_=c}var d=log.window_.document.createElement("div");d.appendChild(log.window_.document.createTextNode(a));log.window_.document.body.appendChild(d);d=null}Light.setCookie=function(b,d,a,f,c,e){if(!c){c=Light.getCookieDomain()}Light.deleteCookie(b,f,c);document.cookie=b+"="+escape(d)+((a)?"; expires="+a.toGMTString():"")+((f)?"; path="+f:"; path= /")+((c)?"; domain="+c:"")+((e)?"; secure":"")};Light.getCookie=function(c){var b=document.cookie;if(!b){return null}var e=c+"=";var d=b.indexOf("; "+e);if(d==-1){d=b.indexOf(e);if(d!=0){return null}}else{d+=2}var a=document.cookie.indexOf(";",d);if(a==-1){a=b.length}return unescape(b.substring(d+e.length,a))};Light.deleteCookie=function(a,c,b){if(Light.getCookie(a)){if(!b){b=Light.getCookieDomain()}document.cookie=a+"="+((c)?"; path="+c:"; path= /")+((b)?"; domain="+b:"")+"; expires=Thu, 01-Jan-70 00:00:01 GMT"}};Light.getMessage=function(b){var a=L$(b);return(a)?a.title:""};Light.getCookieDomain=function(){var b=window.location.hostname;if(b.toLowerCase().startsWith("www.")){b=b.substr(4)}var e=Light._DOMAIN_LIST.split(",");for(var a in e){if(b.indexOf(e[a])>=0){var c=b.substring(0,b.indexOf(e[a]));var d=c.split(".");if(d.length>=2){return"."+d[d.length-1]+e[a]}else{if(d.length==1){return"."+c+e[a]}else{return null}}}}return null};Light.alert=function(a){alert(a)};Light.confirm=function(a){return confirm(a)};Light.newElement=function(d){if(!d.element){return null}var b=document.createElement(d.element);for(var a in d){if(a!="element"){if(a!="style"){b[a]=d[a]}else{for(var c in d.style){b.style[c]=d.style[c]}}}}if(d.element==="a"&&!d.href){b.href="javascript:;"}return b};String.prototype.isNumeric=function(){var e="0123456789.";var d=true;var b;for(var c=0,a=this.length;c<a&&d;c++){b=this.charAt(c);if(e.indexOf(b)==-1){d=false}}return d};String.prototype.isDigit=function(){if(this.length>1){return false}var a="1234567890";if(a.indexOf(this)!=-1){return true}return false};String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")};String.prototype.startsWith=function(a){return this.substring(0,a.length)==a};String.prototype.endsWith=function(a){return(this.match(a+"$")==a)};if(!Array.prototype.map){Array.prototype.map=function(b){var a=this.length;if(typeof b!="function"){throw new TypeError()}var e=new Array(a);var d=arguments[1];for(var c=0;c<a;c++){if(c in this){e[c]=b.call(d,this[c],c,this)}}return e}}if(!Array.prototype.every){Array.prototype.every=function(b){var a=this.length;if(typeof b!="function"){throw new TypeError()}var d=arguments[1];for(var c=0;c<a;c++){if(c in this&&!b.call(d,this[c],c,this)){return false}}return true}}if(!Array.prototype.filter){Array.prototype.filter=function(b){var a=this.length;if(typeof b!="function"){throw new TypeError()}var e=[];var d=arguments[1];for(var c=0;c<a;c++){if(c in this){var f=this[c];if(b.call(d,f,c,this)){e.push(f)}}}return e}}if(!Array.prototype.forEach){Array.prototype.forEach=function(b){var a=this.length;if(typeof b!="function"){throw new TypeError()}var d=arguments[1];for(var c=0;c<a;c++){if(c in this){b.call(d,this[c],c,this)}}}}if(!Array.prototype.indexOf){Array.prototype.indexOf=function(b){var a=this.length;var c=Number(arguments[1])||0;c=(c<0)?Math.ceil(c):Math.floor(c);if(c<0){c+=a}for(;c<a;c++){if(c in this&&this[c]===b){return c}}return -1}}if(!Array.prototype.lastIndexOf){Array.prototype.lastIndexOf=function(b){var a=this.length;var c=Number(arguments[1]);if(isNaN(c)){c=a-1}else{c=(c<0)?Math.ceil(c):Math.floor(c);if(c<0){c+=a}else{if(c>=a){c=a-1}}}for(;c>-1;c--){if(c in this&&this[c]===b){return c}}return -1}}if(!Array.prototype.reduce){Array.prototype.reduce=function(b){var a=this.length;if(typeof b!="function"){throw new TypeError()}if(a==0&&arguments.length==1){throw new TypeError()}var c=0;if(arguments.length>=2){var d=arguments[1]}else{do{if(c in this){d=this[c++];break}if(++c>=a){throw new TypeError()}}while(true)}for(;c<a;c++){if(c in this){d=b.call(null,d,this[c],c,this)}}return d}}if(!Array.prototype.reduceRight){Array.prototype.reduceRight=function(b){var a=this.length;if(typeof b!="function"){throw new TypeError()}if(a==0&&arguments.length==1){throw new TypeError()}var c=a-1;if(arguments.length>=2){var d=arguments[1]}else{do{if(c in this){d=this[c--];break}if(--c<0){throw new TypeError()}}while(true)}for(;c>=0;c--){if(c in this){d=b.call(null,d,this[c],c,this)}}return d}}if(!Array.prototype.some){Array.prototype.some=function(b){var a=this.length;if(typeof b!="function"){throw new TypeError()}var d=arguments[1];for(var c=0;c<a;c++){if(c in this&&b.call(d,this[c],c,this)){return true}}return false}}Array.prototype.exists=function(b){for(var a=0;a<this.length;a++){if(typeof this[a]!=="undefined"&&this[a]!=null&&this[a]==b){return true}}return false};Array.prototype.joinValue=function(a){var c="";for(var b=0;b<this.length;b++){if(typeof this[b]!=="undefined"&&this[b]!=null&&this[b].length>0){if(c.length==0){c=this[b]}else{c+=a+this[b]}}}return c};Array.prototype.get=function(b,c){for(var a=0;a<this.length;a++){if(typeof c!="undefined"&&c!=null){if(typeof this[a]!=="undefined"&&this[a]!=null&&this[a][c]==b){return this[a]}else{if(typeof this[a]!=="undefined"&&this[a]!=null&&this[a]==b){return this[a]}}}}return null};function isIE(){return/msie/i.test(navigator.userAgent)&&!/opera/i.test(navigator.userAgent)}function isFirefox(){var a=navigator.userAgent.toLowerCase();return(a.indexOf("firefox")>=0)?true:false}function isGecko(){var a=navigator.userAgent.toLowerCase();return(a.indexOf("gecko")>=0)?true:false}function isChrome(){var a=navigator.userAgent.toLowerCase();return(a.indexOf("chrome")>=0)?true:false}function isSafari(){var a=navigator.userAgent.toLowerCase();return(a.indexOf("safari/")>=0)?((a.indexOf("chrome")>=0)?false:true):false}function isOpera(){return(typeof window.opera!=="undefined")?true:false}function isIPhone(){return((navigator.userAgent.match(/iPhone/i))&&!(navigator.userAgent.match(/iPad/i)))}function isIPad(){return navigator.userAgent.match(/iPad/i)}function getWindowHeight(){return document.documentElement.scrollHeight}function getMousePositionX(b){var a,c=0;if(!isIE()){if(b){if(b.pageX||b.pageY){a=b.pageX;c=b.pageY}else{if(b.clientX||b.clientY){a=b.clientX+document.body.scrollLeft;c=b.clientY+document.body.scrollTop}}}}else{if(window.event){a=event.clientX+document.body.scrollLeft;c=event.clientY}else{if(b){if(b.pageX||b.pageY){a=b.pageX;c=b.pageY}else{if(b.clientX||b.clientY){a=b.clientX+document.body.scrollLeft;c=b.clientY}}}}}if(!a){a=0}return a}function getMousePositionY(b){var a,c=0;if(!isIE()){if(b){if(b.pageX||b.pageY){a=b.pageX;c=b.pageY}else{if(b.clientX||b.clientY){a=b.clientX+document.body.scrollLeft;c=b.clientY+document.body.scrollTop}}}}else{if(window.event){a=event.clientX;c=event.clientY+document.body.scrollTop}else{if(b){if(b.pageX||b.pageY){a=b.pageX;c=b.pageY}else{if(b.clientX||b.clientY){a=b.clientX;c=b.clientY+document.body.scrollTop}}}}}if(!c){c=0}return c}function setPosition(b,a,c){if(document.all){if(typeof a!="undefined"){b.style.posLeft=a}if(typeof c!="undefined"){b.style.posTop=c}}else{if(typeof a!="undefined"){b.style.left=a}if(typeof c!="undefined"){b.style.top=c}}}function getPositionX(b){var a=0;if(b){if(document.all){a=parseInt(b.style.posLeft)}else{a=parseInt(b.style.left)}}return a}function getPositionY(a){var b=0;if(a){if(document.all){b=parseInt(a.style.posTop)}else{b=parseInt(a.style.top)}}return b}function getX(b){var a=0;if(!isIE()){while(b!=null){a+=b.offsetLeft;b=b.offsetParent}}else{var c=b.getBoundingClientRect();a=c.left;if(document.body.scrollLeft!=null){a=c.left+document.body.scrollLeft}}return a}function getY(b){var a=0;if(!isIE()){while(b!=null){a+=b.offsetTop;b=b.offsetParent}}else{var c=b.getBoundingClientRect();a=c.top;if(document.body.scrollTop!=null){a=c.top+document.body.scrollTop}}return a}function getScreenCenterY(){return getScrollOffset()+(getInnerHeight()/2)}function getScreenCenterX(){return(document.body.clientWidth/2)}function getInnerHeight(){var a;if(self.innerHeight){a=self.innerHeight}else{if(document.documentElement&&document.documentElement.clientHeight){a=document.documentElement.clientHeight}else{if(document.body){a=document.body.clientHeight}}}return a}function getScrollOffset(){var a;if(self.pageYOffset){a=self.pageYOffset}else{if(document.documentElement&&document.documentElement.scrollTop){a=document.documentElement.scrollTop}else{if(document.body){a=document.body.scrollTop}}}return a}function addEventHandler(c,a,b){removeEvent(c,a,b);if(document.attachEvent){c.attachEvent("on"+a,b)}else{if(document.addEventListener){c.addEventListener(a,b,false)}}}function removeEvent(d,a,b){try{if(d.removeEventListener){d.removeEventListener(a,b,false)}else{if(d.detachEvent){d.detachEvent("on"+a,d[a+b]);d[a+b]=null;d["e"+a+b]=null}}}catch(c){}}AIM={portletId:null,frame:function(f){var e="f"+Math.floor(Math.random()*99999);var b=document.createElement("DIV");b.innerHTML='<iframe style="display:none" src="about:blank" id="'+e+'" name="'+e+'" onload="AIM.loaded(\''+e+"')\"></iframe>";document.body.appendChild(b);var a=document.getElementById(e);if(f&&typeof(f.onComplete)=="function"){a.onComplete=f.onComplete}return e},form:function(b,a){b.setAttribute("target",a)},submit:function(b,d,a){AIM.portletId=a;AIM.form(b,AIM.frame(d));if(d&&typeof(d.onStart)=="function"){return d.onStart(a)}else{return true}},loaded:function(c){var a=document.getElementById(c);if(a.contentDocument){var b=a.contentDocument}else{if(a.contentWindow){var b=a.contentWindow.document}else{var b=window.frames[c].document}}if(b.location.href=="about:blank"){return}if(typeof(a.onComplete)=="function"){a.onComplete(AIM.portletId,b.getElementsByTagName("p")[0].childNodes[0].textContent)}}};var Base64={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(c){var a="";var k,h,f,j,g,e,d;var b=0;c=Base64._utf8_encode(c);while(b<c.length){k=c.charCodeAt(b++);h=c.charCodeAt(b++);f=c.charCodeAt(b++);j=k>>2;g=((k&3)<<4)|(h>>4);e=((h&15)<<2)|(f>>6);d=f&63;if(isNaN(h)){e=d=64}else{if(isNaN(f)){d=64}}a=a+this._keyStr.charAt(j)+this._keyStr.charAt(g)+this._keyStr.charAt(e)+this._keyStr.charAt(d)}return a},decode:function(c){var a="";var k,h,f;var j,g,e,d;var b=0;c=c.replace(/[^A-Za-z0-9\+\/\=]/g,"");while(b<c.length){j=this._keyStr.indexOf(c.charAt(b++));g=this._keyStr.indexOf(c.charAt(b++));e=this._keyStr.indexOf(c.charAt(b++));d=this._keyStr.indexOf(c.charAt(b++));k=(j<<2)|(g>>4);h=((g&15)<<4)|(e>>2);f=((e&3)<<6)|d;a=a+String.fromCharCode(k);if(e!=64){a=a+String.fromCharCode(h)}if(d!=64){a=a+String.fromCharCode(f)}}a=Base64._utf8_decode(a);return a},_utf8_encode:function(b){b=b.replace(/\r\n/g,"\n");var a="";for(var e=0;e<b.length;e++){var d=b.charCodeAt(e);if(d<128){a+=String.fromCharCode(d)}else{if((d>127)&&(d<2048)){a+=String.fromCharCode((d>>6)|192);a+=String.fromCharCode((d&63)|128)}else{a+=String.fromCharCode((d>>12)|224);a+=String.fromCharCode(((d>>6)&63)|128);a+=String.fromCharCode((d&63)|128)}}}return a},_utf8_decode:function(a){var b="";var d=0;var e=c1=c2=0;while(d<a.length){e=a.charCodeAt(d);if(e<128){b+=String.fromCharCode(e);d++}else{if((e>191)&&(e<224)){c2=a.charCodeAt(d+1);b+=String.fromCharCode(((e&31)<<6)|(c2&63));d+=2}else{c2=a.charCodeAt(d+1);c3=a.charCodeAt(d+2);b+=String.fromCharCode(((e&15)<<12)|((c2&63)<<6)|(c3&63));d+=3}}}return b}};